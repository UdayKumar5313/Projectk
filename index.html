<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cybersecurity Password Generator</title>
  <style>
    /* ================== GLOBAL STYLES & THEME VARIABLES ================== */
    :root {
      --bg-dark: #121212;
      --bg-light: #eaeaea;
      --primary-dark: #00ff99;
      --secondary-dark: #00adb5;
      --accent-dark: #00ff99;
      --bg-color: var(--bg-dark);
      --font-family: "Courier New", monospace;
    }
    /* Default: dark hacker theme, neon green style */
    body {
      margin: 0;
      padding: 0;
      background-color: var(--bg-color);
      color: var(--primary-dark);
      font-family: var(--font-family);
      overflow-x: hidden;
      cursor: crosshair;
    }
    /* ================= Matrix-style Falling Code Background (Feature 42) ================= */
    canvas#matrix {
      position: fixed;
      top: 0;
      left: 0;
      z-index: -1;
      display: block;
    }
    /* ================= Flickering Scanline Overlay (Feature 47) ================= */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: repeating-linear-gradient(
        180deg,
        rgba(255,255,255,0.02),
        rgba(255,255,255,0.02) 1px,
        transparent 1px,
        transparent 2px
      );
      pointer-events: none;
      animation: scanline 0.5s linear infinite;
    }
    @keyframes scanline {
      0% { transform: translateY(0); }
      100% { transform: translateY(100%); }
    }
    /* ================= Main Container ================= */
    .container {
      max-width: 900px;
      margin: 50px auto;
      padding: 20px;
      background: rgba(0, 0, 0, 0.85);
      border: 2px solid var(--secondary-dark);
      border-radius: 10px;
      box-shadow: 0 0 20px var(--secondary-dark);
      position: relative;
      z-index: 2;
    }
    /* ================= Header with Typing Effect & Blinking Cursor (Features 46 & 45) ================= */
    header {
      text-align: center;
      margin-bottom: 20px;
      position: relative;
    }
    header h1 {
      font-size: 2em;
      margin: 0;
    }
    header h1::after {
      content: "|";
      animation: blink 1s step-start infinite;
    }
    @keyframes blink {
      50% { opacity: 0; }
    }
    /* ================= Controls / Settings ================= */
    .controls {
      margin-bottom: 20px;
    }
    .controls label {
      display: block;
      margin-top: 10px;
      font-size: 0.9em;
    }
    .controls input[type="range"],
    .controls input[type="text"],
    .controls input[type="number"] {
      width: 100%;
      padding: 5px;
      background: #000;
      border: 1px solid var(--secondary-dark);
      color: var(--primary-dark);
      border-radius: 5px;
      outline: none;
    }
    .controls input[type="checkbox"] {
      margin-right: 5px;
    }
    /* Tooltips for guidance (Features 40 and 63) */
    .tooltip {
      position: relative;
      display: inline-block;
    }
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 220px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 5px;
      padding: 5px;
      position: absolute;
      z-index: 3;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
    /* ================= Output Section ================= */
    .output-section {
      margin-top: 20px;
    }
    .output-section .generated-password {
      display: flex;
      align-items: center;
    }
    .output-section input#passwordOutput {
      width: calc(100% - 120px);
      padding: 10px;
      font-size: 1.2em;
      background: #000;
      border: 1px solid var(--secondary-dark);
      color: var(--primary-dark);
      border-radius: 5px;
      outline: none;
      transition: all 0.3s;
    }
    .output-section input#passwordOutput:focus {
      border: 2px solid var(--accent-dark);
      box-shadow: 0 0 10px var(--accent-dark);
    }
    .output-section button {
      padding: 10px 20px;
      background: var(--secondary-dark);
      border: none;
      color: #000;
      font-size: 1em;
      border-radius: 5px;
      cursor: pointer;
      transition: transform 0.3s;
      margin-left: 10px;
    }
    .output-section button:hover {
      transform: scale(1.05);
      /* Glitch hover effect (Feature 43) */
      animation: glitch 0.5s;
    }
    @keyframes glitch {
      0% { text-shadow: 2px 2px var(--primary-dark); }
      50% { text-shadow: -2px -2px var(--secondary-dark); }
      100% { text-shadow: 2px 2px var(--primary-dark); }
    }
    /* Strength Meter (Features 16,17) */
    .strength-meter {
      width: 100%;
      height: 10px;
      background: #000;
      border: 1px solid var(--secondary-dark);
      border-radius: 5px;
      overflow: hidden;
      margin-top: 10px;
    }
    .strength-meter div {
      height: 100%;
      background: var(--accent-dark);
      width: 0%;
      transition: width 0.5s;
    }
    /* History List (Feature 27, 29) */
    .history {
      margin-top: 10px;
      background: #000;
      border: 1px solid var(--secondary-dark);
      border-radius: 5px;
      padding: 10px;
      max-height: 100px;
      overflow-y: auto;
    }
    .history li {
      list-style: none;
      margin: 5px 0;
    }
    /* Button container */
    .btn-container {
      text-align: center;
      margin-top: 20px;
    }
    /* Reset Settings Button (Feature 68) */
    #resetSettings {
      background: var(--secondary-dark);
      border: none;
      padding: 8px 12px;
      color: #000;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }
    /* ================= Loader Animation (Features 48,55) ================= */
    .loader {
      border: 4px solid #000;
      border-top: 4px solid var(--accent-dark);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
      display: none;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    /* Terminal-style Notification (Feature 57) */
    .notification {
      text-align: center;
      margin-top: 10px;
      font-size: 1em;
    }
    /* Accessibility: Focus indicator for all inputs/buttons (Feature 65) */
    input:focus, button:focus {
      outline: 2px dashed var(--accent-dark);
    }
    /* Mobile Responsive (Feature 62) */
    @media (max-width: 600px) {
      .container {
        margin: 20px;
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <!-- ================= Matrix Background Canvas ================= -->
  <canvas id="matrix"></canvas>

  <!-- ================= Main App Container ================= -->
  <div class="container" role="main" aria-label="Password Generator Application">
    <header>
      <h1 id="headerText" aria-live="polite"></h1>
      <!-- Theme switch button (Features 58 & 70) -->
      <button id="themeSwitch" aria-label="Toggle Light/Hacker Theme">Switch Theme</button>
    </header>
    <!-- ================= Controls Section (Core Password Generator Features 1-20) ================= -->
    <div class="controls">
      <label for="lengthRange" title="Select password length (8–64)">Password Length: <span id="lengthDisplay">16</span></label>
      <input type="range" id="lengthRange" min="8" max="64" value="16" aria-label="Password length">
      
      <label><input type="checkbox" id="toggleUppercase" checked title="Include uppercase letters"> Uppercase Letters</label>
      <label><input type="checkbox" id="toggleLowercase" checked title="Include lowercase letters"> Lowercase Letters</label>
      <label><input type="checkbox" id="toggleNumbers" checked title="Include numbers"> Numbers</label>
      <label><input type="checkbox" id="toggleSpecial" checked title="Include special characters"> Special Characters</label>
      <label><input type="checkbox" id="excludeSimilar" title="Exclude similar characters (l, 1, I, O, 0)"> Exclude Similar Characters</label>
      
      <label><input type="checkbox" id="optionPronounceable" title="Generate pronounceable password"> Pronounceable Password</label>
      <label><input type="checkbox" id="optionPassphrase" title="Generate passphrase (words separated by symbols)"> Passphrase Mode</label>
      <label><input type="checkbox" id="toggleRandomCapital" title="Randomly capitalize passphrase words"> Random Capitalization</label>
      
      <label for="customSymbols" title="Custom symbol/character input field">Custom Symbols/Chars:</label>
      <input type="text" id="customSymbols" placeholder="e.g., @#$%" aria-label="Custom symbols">
      
      <label><input type="checkbox" id="preventDictionary" title="Prevent dictionary words"> Prevent Dictionary Words</label>
      <label><input type="checkbox" id="preventPatterns" title="Prevent common patterns"> Prevent Common Patterns</label>
      <label><input type="checkbox" id="preventRepeats" title="Prevent repeated characters"> Prevent Repeated Characters</label>
      <label><input type="checkbox" id="preventKeySeq" title="Detect keyboard sequences"> Detect Keyboard Sequences</label>
      
      <div class="tooltip">Strength Meter & Info
        <span class="tooltiptext">Real-time strength, entropy (in bits), estimated brute-force time, and a security score.</span>
      </div>
      <div class="strength-meter"><div id="strengthBar"></div></div>
      <div>Entropy: <span id="entropyDisplay">0</span> bits – Brute-force: <span id="bruteForceDisplay">0 sec</span></div>
      <div>Secure Score: <span id="secureScore" aria-live="polite"></span></div>
      
      <div>Expires in: <span id="expirationTimer">60</span> sec</div>
    </div>
    
    <!-- ================= Clipboard & Output Section (Features 21-30) ================= -->
    <div class="output-section">
      <div class="generated-password">
        <input type="text" id="passwordOutput" readonly aria-label="Generated password">
        <!-- Toggle visibility button (Feature 25) -->
        <button id="toggleVisibility" aria-label="Toggle password visibility">Show</button>
      </div>
      <div class="btn-container">
        <button id="copyButton" aria-label="Copy password">Copy</button>
        <button id="regenerateButton" aria-label="Regenerate password">Regenerate</button>
        <button id="exportButton" aria-label="Export password as encrypted file">Export</button>
      </div>
      <div class="notification" id="clipboardNotification" aria-live="polite"></div>
      <!-- Password History (last 5) (Features 27, 29) -->
      <ul class="history" id="passwordHistory" aria-label="Password history"></ul>
    </div>
    
    <!-- ================= Cybersecurity Simulation & Alerts (Features 31-40) ================= -->
    <div class="simulation">
      <button id="simulate2FA" aria-label="Simulate 2FA code">Simulate 2FA</button>
      <div id="twoFACode" aria-live="polite"></div>
      <button id="simulateBruteForce" aria-label="Brute-force simulator">Simulate Brute-Force</button>
      <div id="bruteForceSim" aria-live="polite"></div>
    </div>
    
    <!-- Tooltip guidance already provided via .tooltip elements (Feature 40) -->
    
    <!-- ================= Command Prompt (Easter Egg & Simulated CLI) (Features 54,59) ================= -->
    <div class="console" style="margin-top:20px;">
      <input type="text" id="consoleCommand" placeholder="Enter console command..." aria-label="Console command">
    </div>
    
    <!-- Reset Settings Button (Feature 68) -->
    <button id="resetSettings" aria-label="Reset all settings">Reset Settings</button>
  </div>
  
  <!-- ================= Loader Animation (Features 48,55) ================= -->
  <div class="loader" id="loader"></div>
  
  <!-- ================= Optional Audio Elements for Sounds (Features 52,53,69) ================= -->
  <audio id="copySound" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQgAAAAA"></audio>
  <audio id="clickSound" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQgAAAAA"></audio>
  
  <script>
    /******************* JAVASCRIPT CODE *******************/
    // ================= Utility Functions =================
    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    // Secure random number [Feature 1]
    function secureRandom(min, max) {
      let range = max - min;
      let arr = new Uint32Array(1);
      window.crypto.getRandomValues(arr);
      return min + (arr[0] % range);
    }
    
    // ================= Global Variables & Preferences =================
    let passwordLog = [];  // Session-based log (Feature 29)
    const maxHistory = 5;
    let expirationTime = 60;  // seconds (Feature 19)
    let expirationInterval;
    let soundEnabled = JSON.parse(localStorage.getItem("soundEnabled") || "true");
    
    // Save and load user preferences (Feature 66)
    function savePreferences() {
      let prefs = {
        length: document.getElementById("lengthRange").value,
        toggleUppercase: document.getElementById("toggleUppercase").checked,
        toggleLowercase: document.getElementById("toggleLowercase").checked,
        toggleNumbers: document.getElementById("toggleNumbers").checked,
        toggleSpecial: document.getElementById("toggleSpecial").checked,
        excludeSimilar: document.getElementById("excludeSimilar").checked,
        optionPronounceable: document.getElementById("optionPronounceable").checked,
        optionPassphrase: document.getElementById("optionPassphrase").checked,
        toggleRandomCapital: document.getElementById("toggleRandomCapital").checked,
        customSymbols: document.getElementById("customSymbols").value,
        preventDictionary: document.getElementById("preventDictionary").checked,
        preventPatterns: document.getElementById("preventPatterns").checked,
        preventRepeats: document.getElementById("preventRepeats").checked,
        preventKeySeq: document.getElementById("preventKeySeq").checked,
        soundEnabled: soundEnabled
      };
      localStorage.setItem("prefs", JSON.stringify(prefs));
    }
    function loadPreferences() {
      let prefs = localStorage.getItem("prefs");
      if(prefs) {
        prefs = JSON.parse(prefs);
        document.getElementById("lengthRange").value = prefs.length;
        document.getElementById("toggleUppercase").checked = prefs.toggleUppercase;
        document.getElementById("toggleLowercase").checked = prefs.toggleLowercase;
        document.getElementById("toggleNumbers").checked = prefs.toggleNumbers;
        document.getElementById("toggleSpecial").checked = prefs.toggleSpecial;
        document.getElementById("excludeSimilar").checked = prefs.excludeSimilar;
        document.getElementById("optionPronounceable").checked = prefs.optionPronounceable;
        document.getElementById("optionPassphrase").checked = prefs.optionPassphrase;
        document.getElementById("toggleRandomCapital").checked = prefs.toggleRandomCapital;
        document.getElementById("customSymbols").value = prefs.customSymbols;
        document.getElementById("preventDictionary").checked = prefs.preventDictionary;
        document.getElementById("preventPatterns").checked = prefs.preventPatterns;
        document.getElementById("preventRepeats").checked = prefs.preventRepeats;
        document.getElementById("preventKeySeq").checked = prefs.preventKeySeq;
      }
    }
    // Restore last generated password on reload (Feature 67)
    function restoreLastPassword() {
      let last = localStorage.getItem("lastPassword");
      if(last) {
        document.getElementById("passwordOutput").value = last;
      }
    }
    // ================= MATRIX BACKGROUND ANIMATION (Feature 42) =================
    const canvas = document.getElementById("matrix");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    const matrixChars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()-+";
    const fontSize = 16;
    const columns = canvas.width / fontSize;
    const drops = Array.from({length: columns}, () => Math.floor(Math.random() * canvas.height / fontSize));
    function drawMatrix() {
      ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = (getComputedStyle(document.documentElement).getPropertyValue("--primary-dark")).trim();
      ctx.font = fontSize + "px " + var(--font-family);
      for(let i = 0; i < drops.length; i++) {
        const text = matrixChars.charAt(Math.floor(Math.random() * matrixChars.length));
        ctx.fillText(text, i * fontSize, drops[i] * fontSize);
        if(drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
          drops[i] = 0;
        }
        drops[i]++;
      }
      requestAnimationFrame(drawMatrix);
    }
    drawMatrix();
    
    // ================= Password Generation Functions =================
    // Core password (Features 2-7, 11)
    function generatePassword() {
      savePreferences();
      let length = parseInt(document.getElementById("lengthRange").value);
      let charset = "";
      if(document.getElementById("toggleUppercase").checked) charset += "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      if(document.getElementById("toggleLowercase").checked) charset += "abcdefghijklmnopqrstuvwxyz";
      if(document.getElementById("toggleNumbers").checked) charset += "0123456789";
      if(document.getElementById("toggleSpecial").checked) charset += "!@#$%^&*()-_=+[]{}|;:,.<>/?";
      if(document.getElementById("excludeSimilar").checked) {
        charset = charset.replace(/[l1IO0]/g, "");
      }
      let custom = document.getElementById("customSymbols").value;
      if(custom) charset += custom;
      
      // Handle Passphrase (Feature 9) or Pronounceable (Feature 8 & 10)
      if(document.getElementById("optionPassphrase").checked) {
        return generatePassphrase(length);
      }
      if(document.getElementById("optionPronounceable").checked) {
        return generatePronounceable(length, document.getElementById("toggleRandomCapital").checked);
      }
      
      // Default: secure randomly generated password
      let pwd = "";
      for(let i = 0; i < length; i++) {
        pwd += charset.charAt(secureRandom(0, charset.length));
      }
      // Feature 12: Detect/prevent dictionary words
      if(document.getElementById("preventDictionary").checked && detectDictionaryWord(pwd)) {
        return generatePassword();
      }
      // Feature 13: Prevent common patterns
      if(document.getElementById("preventPatterns").checked && detectCommonPatterns(pwd)) {
        return generatePassword();
      }
      // Feature 14: Prevent repeated characters (simple check)
      if(document.getElementById("preventRepeats").checked && /(.)\1\1/.test(pwd)) {
        return generatePassword();
      }
      // Feature 15: Detect keyboard sequences
      if(document.getElementById("preventKeySeq").checked && detectKeySequences(pwd)) {
        return generatePassword();
      }
      return pwd;
    }
    function detectDictionaryWord(pwd) {
      const dict = ["password", "admin", "welcome", "login"];
      for(let w of dict) {
        if(pwd.toLowerCase().includes(w)) return true;
      }
      return false;
    }
    function detectCommonPatterns(pwd) {
      const patterns = ["1234", "abcd", "qwerty"];
      for(let p of patterns) {
        if(pwd.toLowerCase().includes(p)) return true;
      }
      return false;
    }
    function detectKeySequences(pwd) {
      const seqs = ["qwerty", "asdf", "zxcv"];
      for(let s of seqs) {
        if(pwd.toLowerCase().includes(s)) return true;
      }
      return false;
    }
    // Pronounceable password generator (Feature 8 & 10)
    function generatePronounceable(length, randomCap) {
      const vowels = "aeiou", cons = "bcdfghjklmnpqrstvwxyz";
      let pwd = "";
      for(let i = 0; i < length; i++) {
        let char = (i % 2 === 0) ? cons.charAt(secureRandom(0, cons.length)) : vowels.charAt(secureRandom(0, vowels.length));
        if(randomCap && Math.random() > 0.5) char = char.toUpperCase();
        pwd += char;
      }
      return pwd;
    }
    // Passphrase generator (Feature 9)
    function generatePassphrase(numWords) {
      const words = ["cyber", "matrix", "hacker", "secure", "code", "firewall", "encrypt", "data", "access", "override"];
      const symbols = "!@#$%^&*";
      let phrase = "";
      for(let i = 0; i < numWords; i++) {
        phrase += words[secureRandom(0, words.length)];
        if(i < numWords - 1) phrase += symbols.charAt(secureRandom(0, symbols.length));
      }
      return phrase;
    }
    
    // ================= Strength Meter, Entropy & Brute-force Estimation =================
    function updateStrength(pwd) {
      // Estimate charset size roughly based on present character types
      let size = 0;
      if(/[A-Z]/.test(pwd)) size += 26;
      if(/[a-z]/.test(pwd)) size += 26;
      if(/[0-9]/.test(pwd)) size += 10;
      if(/[\W_]/.test(pwd)) size += 32;
      let entropy = (pwd.length * Math.log2(size)).toFixed(2);
      document.getElementById("entropyDisplay").textContent = entropy;
      // Estimated brute-force time (assuming 1e9 guesses/sec)
      let seconds = Math.pow(2, entropy) / 1e9;
      document.getElementById("bruteForceDisplay").textContent = seconds.toFixed(2) + " sec";
      // Update strength meter (arbitrary scaling)
      let percent = Math.min((entropy / 100) * 100, 100);
      document.getElementById("strengthBar").style.width = percent + "%";
      // Secure Score badge (Feature 20)
      let score = (entropy >= 60 ? "Secure" : "Insecure");
      document.getElementById("secureScore").textContent = score;
      // Feature 36: Alert if entropy below 60 bits
      if(entropy < 60) {
        alert("Warning: Entropy below 60 bits!");
      }
      // Feature 37: Notify if not meeting minimal OWASP guidelines (min length 12)
      if(pwd.length < 12) {
        alert("Warning: Does not meet OWASP guidelines (min length 12)!");
      }
    }
    
    // ================= Password Expiration Timer (Feature 19) =================
    function startExpirationTimer() {
      let timerSpan = document.getElementById("expirationTimer");
      let timeLeft = expirationTime;
      timerSpan.textContent = timeLeft;
      clearInterval(expirationInterval);
      expirationInterval = setInterval(() => {
        timeLeft--;
        timerSpan.textContent = timeLeft;
        if(timeLeft <= 0) {
          clearInterval(expirationInterval);
          triggerGeneration();
        }
      }, 1000);
    }
    
    // ================= Clipboard Functions (Features 21-24) =================
    async function copyToClipboard() {
      try {
        await navigator.clipboard.writeText(document.getElementById("passwordOutput").value);
        // Visual feedback (Feature 22)
        document.getElementById("copyButton").classList.add("glitch");
        setTimeout(() => {
          document.getElementById("copyButton").classList.remove("glitch");
        }, 500);
        document.getElementById("clipboardNotification").textContent = "Password Copied!";
        // Auto-clear after 15 sec (Feature 23)
        setTimeout(async () => {
          await navigator.clipboard.writeText("");
          document.getElementById("clipboardNotification").textContent = "";
        }, 15000);
      } catch (e) {
        document.getElementById("clipboardNotification").textContent = "Copy failed!";
      }
    }
    
    // ================= Toggle Password Visibility (Feature 25) =================
    function toggleVisibility() {
      let input = document.getElementById("passwordOutput");
      let btn = document.getElementById("toggleVisibility");
      if(input.type === "text") {
        input.type = "password";
        btn.textContent = "Show";
      } else {
        input.type = "text";
        btn.textContent = "Hide";
      }
    }
    
    // ================= Regenerate Password (Feature 26) =================
    function triggerGeneration() {
      document.getElementById("loader").style.display = "block";
      setTimeout(() => {
        let pwd = generatePassword();
        document.getElementById("passwordOutput").value = pwd;
        updateStrength(pwd);
        // Save last password (Feature 67)
        localStorage.setItem("lastPassword", pwd);
        // History (Feature 27)
        if(!passwordLog.includes(pwd)) {
          passwordLog.push(pwd);
          if(passwordLog.length > maxHistory) passwordLog.shift();
          updateHistory();
        } else {
          // Warning on reused password (Feature 28)
          alert("This password was generated earlier in this session.");
        }
        document.getElementById("loader").style.display = "none";
        startExpirationTimer();
        // Cybersecurity simulation: breach check (Features 31,32)
        breachCheck(pwd);
        // Validate OWASP (Features 37-39)
        validateOWASP(pwd);
      }, 1000); // simulate calculating delay (Feature 48)
    }
    function updateHistory() {
      let hist = document.getElementById("passwordHistory");
      hist.innerHTML = "";
      passwordLog.forEach(p => {
        let li = document.createElement("li");
        li.textContent = p;
        hist.appendChild(li);
      });
      // Session log (Feature 29)
    }
    
    // ================= Export as Encrypted File (Feature 30) =================
    function exportPassword() {
      let pwd = document.getElementById("passwordOutput").value;
      let encrypted = btoa(pwd); // simple encryption (base64)
      let blob = new Blob([encrypted], {type: "text/plain;charset=utf-8"});
      let a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "password.enc";
      a.click();
    }
    
    // ================= Cybersecurity Simulation Functions =================
    // Local mock breach checker (Features 31 & 32)
    function breachCheck(pwd) {
      const breached = ["Password123!", "Qwerty!@#", "12345678"];
      if(breached.includes(pwd)) {
        alert("Warning: This password is in the breached list!");
      }
    }
    // Fake 2FA code generator (Feature 33)
    function simulate2FA() {
      let code = secureRandom(100000, 999999);
      document.getElementById("twoFACode").textContent = "2FA Code: " + code;
    }
    // Brute-force simulator (Feature 34)
    function simulateBruteForce() {
      let sim = document.getElementById("bruteForceSim");
      sim.textContent = "Simulating brute-force attack...";
      setTimeout(() => {
        sim.textContent = "Brute-force simulation complete!";
      }, 2000);
    }
    // Simulated lockout for weak settings (Feature 35) – called in validateOWASP below
    // Validate and notify for OWASP compliance (Features 37-39)
    function validateOWASP(pwd) {
      let meets = pwd.length >= 12;
      if(!meets) {
        alert("Password does not meet OWASP guidelines (min 12 characters)!");
      }
      return meets;
    }
    
    // ================= Animations & Sounds =================
    // Play sound (Features 52,53)
    function playSound(id) {
      if(soundEnabled) {
        document.getElementById(id).play();
      }
    }
    // Toggle sound effects on/off (Feature 69): Press 's' key to toggle sound
    document.addEventListener("keydown", e => {
      if(e.key === "s") {
        soundEnabled = !soundEnabled;
        localStorage.setItem("soundEnabled", JSON.stringify(soundEnabled));
        alert("Sound effects " + (soundEnabled ? "enabled" : "disabled"));
      }
    });
    
    // ================= Theme Switch & Hack Theme (Features 58,70) =================
    let currentTheme = "dark";
    document.getElementById("themeSwitch").addEventListener("click", () => {
      if(currentTheme === "dark") {
        document.body.style.backgroundColor = "var(--bg-light)";
        document.body.style.color = "#000";
        currentTheme = "light";
      } else {
        document.body.style.backgroundColor = "var(--bg-dark)";
        document.body.style.color = "var(--primary-dark)";
        currentTheme = "dark";
      }
    });
    
    // ================= Command Prompt Easter Egg & Simulated CLI (Features 54,59) =================
    document.getElementById("consoleCommand").addEventListener("keydown", function(e){
      if(e.key === "Enter"){
        let cmd = this.value.trim().toLowerCase();
        if(cmd === "sudo generate") {
          triggerGeneration();
          alert("Easter Egg Activated: Forced Generation!");
        } else {
          alert("Unknown command: " + cmd);
        }
        this.value = "";
      }
    });
    
    // ================= Konami Code Easter Egg (Feature 60) =================
    const konamiCode = [38,38,40,40,37,39,37,39,66,65];
    let konamiIndex = 0;
    document.addEventListener("keydown", function(e) {
      if(e.keyCode === konamiCode[konamiIndex]) {
        konamiIndex++;
        if(konamiIndex === konamiCode.length) {
          alert("Konami Code Activated! Enjoy the secret mode!");
          konamiIndex = 0;
        }
      } else {
        konamiIndex = 0;
      }
    });
    
    // ================= Button Event Listeners =================
    document.getElementById("copyButton").addEventListener("click", () => {
      playSound("clickSound");
      copyToClipboard();
    });
    document.getElementById("regenerateButton").addEventListener("click", () => {
      playSound("clickSound");
      triggerGeneration();
    });
    document.getElementById("exportButton").addEventListener("click", () => {
      playSound("clickSound");
      exportPassword();
    });
    document.getElementById("toggleVisibility").addEventListener("click", toggleVisibility);
    document.getElementById("simulate2FA").addEventListener("click", simulate2FA);
    document.getElementById("simulateBruteForce").addEventListener("click", simulateBruteForce);
    document.getElementById("resetSettings").addEventListener("click", () => {
      localStorage.removeItem("prefs");
      localStorage.removeItem("lastPassword");
      location.reload();
    });
    
    // ================= Typing Effect for Header (Feature 46) =================
    function typeWriter(element, text, speed) {
      let i = 0;
      element.textContent = "";
      let timer = setInterval(() => {
        element.textContent += text.charAt(i);
        i++;
        if(i === text.length) clearInterval(timer);
      }, speed);
    }
    
    // ================= Initialize App =================
    window.onload = () => {
      loadPreferences();
      restoreLastPassword();
      typeWriter(document.getElementById("headerText"), "Cybersecurity Password Generator", 100);
      triggerGeneration();
    };
    
  </script>
</body>
</html>
